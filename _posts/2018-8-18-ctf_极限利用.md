---
layout:     post
title:      ctf-极限利用
subtitle:   ctf
date:       2018-08-18 				# 时间
author:     sh1llc0de					# 作者
catalog: true 						# 是否归档
tags:								#标签
    - CTF
---

# ctf_极限利用
>前几天看到安全客上面有一道ctf的文章，然后自己看的一脸蒙蔽，通过一些学习还是学会了。

## 源码
```php
<?php
include 'flag.php';
if(isset($_GET['code'])){
    $code = $_GET['code'];
    if(strlen($code)>40){
        die("Long.");
    }
    if(preg_match("/[A-Za-z0-9]+/",$code)){
        die("NO.");
    }
    @eval($code);
}else{
    highlight_file(__FILE__);
}
//$hint =  "php function getFlag() to get flag";
?>
```

## 分析
* 首先我们传入的值不能有大小写字母和数字
* 其次我们传入的值长度不能大于40

## 思路
  首先hint信息提示我们是要通过getflag函数来获取flag，但是本人实力有限，用了安全客的第二种方法，我们可以不执行getflag函数，因为Linux下的一切都是文件，那不如去构造一个读文件，或者命令执行来读flag，思路确定后开始尝试。

### 取回结果
  原作者是说采用`<?=$_?>`方式来获取，我当时看的反正一脸蒙蔽，在一些大佬的帮助下知道了这个是短标签(原来看到过，记性不好)，<?=也就是等价于<?php echo，当然要使用短标签的话要开启short_open_tag这个选项，这样我们就可以取回结果了。

### 如何构造字母？执行命令？
  原来在p牛的代码审计中的题目看到过可以通过某些值亦或某些值来构造字母，但是还是本人实力的问题。。所以我还是采用了作者的方法，使用通配符来绕过不能是用字母。

### 开始尝试
  首先先尝试一下获取index.php的源码，可以这样构造"?code=$_=`/???/??? /???/???/????/*`;?><?=$_?>",稍微解释一下，通过给$_赋值我们要执行的命令，然后通过php短标签来执行命令并打印。然后屏幕上应该回显了一大堆的乱码，而我们要的源码在最底部。
![](https://s1.ax1x.com/2018/08/18/Pf6FiT.jpg)
	
  知道源码之后我们发现flag.php是读取的/flag的内容的，按我们直接构造呗"?code=$_=`/???/??? /????`;?><?=$_?>"同样的，我们的flag还是在最底部。
![](https://s1.ax1x.com/2018/08/18/Pf6Ez4.jpg)

### 总结
  这到题目十分的灵活，让我知道了许多不知道的内容，同时也感谢大佬们的帮助。
	
### 原文地址:	https://www.anquanke.com/post/id/154284
